var tableSortModule=angular.module("tableSort",[]);tableSortModule.provider("tableSortConfig",function(){this.filterTemplate="",this.filterFunction=void 0,this.paginationTemplate="",this.perPageOptions=[10,25,50,100],this.perPageDefault=this.perPageOptions[0],this.itemNameSingular="item",this.itemNamePlural=this.itemNameSingular+"s",this.noDataText="No "+this.itemNamePlural,this.wrappingElementClass="",isNaN(this.perPageDefault)||-1!==this.perPageOptions.indexOf(this.perPageDefault)||this.perPageOptions.push(this.perPageDefault),this.perPageOptions.sort(function(e,t){return e-t}),this.$get=function(){return this}}),tableSortModule.directive("tsWrapper",["$parse","$compile",function(e,t){"use strict";function r(e,t){return t.replace(/FILTER_STRING/g,"filtering.filterString").replace(/CURRENT_PAGE_RANGE/g,"pagination.getPageRangeString(TOTAL_COUNT)").replace(/TOTAL_COUNT/g,e.itemsArrayExpression+".length").replace(/PER_PAGE_OPTIONS/g,"pagination.perPageOptions").replace(/ITEMS_PER_PAGE/g,"pagination.perPage").replace(/ITEM_NAME_SINGULAR/g,"itemNameSingular").replace(/ITEM_NAME_PLURAL/g,"itemNamePlural").replace(/FILTERED_COUNT/g,"filtering.filteredCount").replace(/CURRENT_PAGE_NUMBER/g,"pagination.currentPage")}function i(){function e(e,t){return e>t?1:t>e?-1:0}var t=e,r=e;"object"==typeof Intl?t=new Intl.Collator(void 0,{sensitivity:"case"}).compare:"function"==typeof String.prototype.localeCompare&&(t=function(e,t){return(e+"").localeCompare(t,void 0,{sensitivity:"case"})});var i=function(e,i){return"number"==typeof e&&"number"==typeof i?r(e,i):e instanceof Date&&i instanceof Date?r(e.getTime(),i.getTime()):t(e,i)};return i}var a=i();return{scope:!0,controller:["$scope","tableSortConfig",function(t,r){t.pagination={template:r.paginationTemplate,perPageOptions:r.perPageOptions.concat(),perPage:r.perPageDefault,currentPage:1,getPageRangeString:function(e){var r=e!==t.filtering.filteredCount?t.filtering.filteredCount:e,i=Math.max((t.pagination.currentPage-1)*t.pagination.perPage+1,1),a=Math.min(t.pagination.currentPage*t.pagination.perPage,r);return 0===t.filtering.filteredCount?"":(a===r&&1===i?"":i+"-")+a}},t.filtering={template:r.filterTemplate,filterString:"",filterFunction:r.filterFunction,filteredCount:0,filterFields:[]},t.itemsArrayExpression="",t.itemNameSingular=r.itemNameSingular,t.itemNamePlural=r.itemNamePlural,t.noDataText=r.noDataText,t.wrappingElementClass=r.wrappingElementClass,t.sortExpression=[],t.headings=[];var i=function(t,r){return[e(t),null,!1,r?r:t]};this.setSortField=function(e,r,a,n){var s,l=i(e,a);if(l.push(n),1===t.sortExpression.length&&t.sortExpression[0][0]===l[0])t.sortExpression[0][2]?(r.removeClass("tablesort-desc"),r.addClass("tablesort-asc"),t.sortExpression[0][2]=!1):(r.removeClass("tablesort-asc"),r.addClass("tablesort-desc"),t.sortExpression[0][2]=!0),t.$emit("tablesort:sortOrder",[{name:t.sortExpression[0][3],order:t.sortExpression[0][2]}]);else{for(s=0;s<t.headings.length;s+=1)t.headings[s].removeClass("tablesort-desc").removeClass("tablesort-asc");r.addClass("tablesort-asc"),t.sortExpression=[l],t.$emit("tablesort:sortOrder",[{name:l[3],order:l[2]}])}},this.addSortField=function(e,r,a,n){var s,l=!1,o=i(e,a);for(o.push(n),s=0;s<t.sortExpression.length;s+=1)t.sortExpression[s][0]===o[0]&&(t.sortExpression[s][2]?(r.removeClass("tablesort-desc"),r.addClass("tablesort-asc"),t.sortExpression[s][2]=!1):(r.removeClass("tablesort-asc"),r.addClass("tablesort-desc"),t.sortExpression[s][2]=!0),l=!0);l||(r.addClass("tablesort-asc"),t.sortExpression.push(o)),t.$emit("tablesort:sortOrder",t.sortExpression.map(function(e){return{name:e[3],order:e[2]}}))},this.setTrackBy=function(e){t.trackBy=e},this.registerHeading=function(e){t.headings.push(e)},this.addFilterField=function(e){var r=i(e);t.filtering.filterFields.push(r)},this.setArrayExpr=function(e){t.itemsArrayExpression=e}}],link:function(i,n,s,l){function o(e){try{var t=i.$eval(e);return t?t:e}catch(r){return e}}if(s.tsItemName){var p="No "+i.itemNamePlural;i.itemNameSingular=o(s.tsItemName),i.itemNamePlural=s.tsItemNamePlural?o(s.tsItemNamePlural):o(s.tsItemName)+"s",s.tsNoDataText||i.noDataText!==p||(i.noDataText="No "+i.itemNamePlural)}if(s.tsNoDataText&&(i.noDataText=o(s.tsNoDataText)),s.tsWrappingElementClass&&(i.wrappingElementClass=s.tsWrappingElementClass),s.tsPerPageOptions&&(i.pagination.perPageOptions=i.$eval(s.tsPerPageOptions)),s.tsPerPageDefault){var u=i.$eval(s.tsPerPageDefault);isNaN(u)||(i.pagination.perPage=u,-1===i.pagination.perPageOptions.indexOf(i.pagination.perPage)&&(i.pagination.perPageOptions.push(i.pagination.perPage),i.pagination.perPageOptions.sort(function(e,t){return e-t})))}if(s.tsFilterFields)for(var g=s.tsFilterFields.split(",").filter(function(e){return e&&""!==e.trim()}),c=0;c<g.length;c+=1)l.addFilterField(g[c]);var f;if("false"!==s.tsDisplayFiltering&&""!==i.filtering.template&&i.filtering.filterFields.length>0){var d=r(i,i.filtering.template);f=t(d)(i),n.parent()[0].insertBefore(f[0],n[0])}s.tsFilterFunction&&(i.filtering.filterFunction=i.$eval(s.tsFilterFunction)),angular.isFunction(i.filtering.filterFunction)||(i.filtering.filterFunction=0===i.filtering.filterFields.length?function(){return!0}:function(e){for(var t=!1,r=0;r<i.filtering.filterFields.length;r+=1)if(!t){var a=(i.filtering.filterFields[r][0](e)||"").toString().toLowerCase();t=a.indexOf(i.filtering.filterString.toLowerCase())>-1}return t}),i.filterLimitFun=function(e){if(!s.tsFilterFunction&&""===i.filtering.filterString)return i.filtering.filteredCount=e.length,e;var t=e.filter(i.filtering.filterFunction);return i.filtering.filteredCount=t.length,t},i.sortFun=function(e,t){var r,n,s,l,o,p;for(r=0;r<i.sortExpression.length;r+=1){if(n=i.sortExpression[r][0](e),s=i.sortExpression[r][0](t),o=t[i.sortExpression[r][1]],o&&(n=o(n),s=o(s)),(void 0===n||null===n)&&(n=""),(void 0===s||null===s)&&(s=""),l=i.sortExpression[r][2],p=(i.sortExpression[r][4]||a)(n,s),1===p)return l?-1:1;if(-1===p)return l?1:-1}if(i.trackBy){if(n=e[i.trackBy],s=t[i.trackBy],(void 0===n||null===n)&&(n=""),(void 0===s||null===s)&&(s=""),p=a(n,s),1===p)return l?-1:1;if(-1===p)return l?1:-1}return 0},i.pageLimitFun=function(e){if("false"===s.tsDisplayPagination||""===i.pagination.template)return e;for(var t=(i.pagination.currentPage-1)*i.pagination.perPage,r=i.pagination.currentPage*i.pagination.perPage,a=[],n=0;n<e.length;n++)n>=t&&r>n&&a.push(e[n]);return a};var m;if("false"!==s.tsDisplayPagination&&""!==i.pagination.template){var h=r(i,i.pagination.template);m=t(h)(i),n.after(m)}var b;if(i.wrappingElementClass&&""!==i.wrappingElementClass&&(b=n.wrap("<div class='"+i.wrappingElementClass+"' />")),s.tsGetTableDataFunction){var v=e(s.tsGetTableDataFunction),C=v.assign,P=function(t,r,a){var n=e(i.itemsArrayExpression)(i);return t&&(n=n.sort(i.sortFun)),r&&(n=i.filterLimitFun(n)),a&&(n=i.pageLimitFun(n)),n};C(i.$parent,P)}i.$on("$destroy",function(){f&&f.remove(),m&&m.remove(),b&&b.replaceWith(n)})}}}]),tableSortModule.directive("tsCriteria",function(){return{require:"^tsWrapper",scope:{tsOrderBy:"="},link:function(e,t,r,i){var a=function(a){e.$apply(function(){a.shiftKey?i.addSortField(r.tsCriteria,t,r.tsName,e.tsOrderBy):i.setSortField(r.tsCriteria,t,r.tsName,e.tsOrderBy)})},n=function(a){e.$apply(function(){(13===a.which||32===a.which)&&i.setSortField(r.tsCriteria,t,r.tsName,e.tsOrderBy)})};t[t.on?"on":"bind"]("click",a),t[t.on?"on":"bind"]("keypress",n),t.addClass("tablesort-sortable"),"tsDefault"in r&&"0"!==r.tsDefault&&void 0!==r.tsDefault&&(i.addSortField(r.tsCriteria,t,r.tsName,e.tsOrderBy),"descending"===r.tsDefault&&i.addSortField(r.tsCriteria,t,r.tsName,e.tsOrderBy)),"tsFilter"in r&&i.addFilterField(r.tsCriteria,t),i.registerHeading(t)}}}),tableSortModule.directive("tsRepeat",["$compile","$interpolate",function(e,t){return{terminal:!0,multiElement:!0,require:"^tsWrapper",priority:1e6,link:function(r,i,a,n){for(var s=["ng-repeat","data-ng-repeat","ng-repeat-start","data-ng-repeat-start"],l=s[0],o="ts-repeat",p=0;p<s.length;p++)if(angular.isDefined(i.attr(s[p]))){l=s[p],o=l.replace(/^(data-)?ng/,"$1ts");break}var u="tablesortOrderBy:sortFun | tablesortLimit:filterLimitFun | tablesortLimit:pageLimitFun",g=i.attr(l),c=/^\s*([\s\S]+?)\s+in\s+([\s\S]+?)(\s+track\s+by\s+[\s\S]+?)?\s*$/,f=g.match(/\s+track\s+by\s+\S+?\.(\S+)/),d=g.match(c);if(f&&n.setTrackBy(f[1]),-1!==g.search(/tablesort/)?(g=g.replace(/tablesort/,u),f&&(g=g.replace(f[0],"")+f[0])):g=g.replace(c,"$1 in $2 | "+u+"$3"),angular.isUndefined(a.tsHideNoData)){var m=t.startSymbol(),h=t.endSymbol(),b=angular.element(i[0]).clone();b.removeAttr(l),b.removeAttr(o),b.addClass("showIfLast"),b.children().remove(),b.append('<td colspan="'+i[0].childElementCount+'">'+m+"noDataText"+h+"</td>"),b=e(b)(r),i.parent().prepend(b)}n.setArrayExpr(d[2]),angular.element(i[0]).attr(l,g),e(i,null,1e6)(r)}}}]),tableSortModule.filter("tablesortLimit",function(){return function(e,t){return e?t(e):void 0}}),tableSortModule.filter("tablesortOrderBy",function(){return function(e,t){if(e){var r=e.concat();return r.sort(t)}}}),tableSortModule.filter("parseInt",function(){return function(e){return parseInt(e)||null}}),tableSortModule.filter("parseFloat",function(){return function(e){return parseFloat(e)||null}}),tableSortModule.filter("parseDate",function(){return function(e){var t=Date.parse(e);return isNaN(t)?null:t}}),function(e){e.module("ngCierLib.config",[]).value("ngCierLib.config",{debug:!0}),e.module("ngCierLib.directives",["nvd3"]),e.module("ngCierLib.filters",[]),e.module("ngCierLib.services",[]),e.module("ngCierLib",["ngCierLib.config","ngCierLib.directives","ngCierLib.filters","ngCierLib.services","ngResource","ngCookies","ngSanitize","tableSort"])}(angular),angular.module("ngCierLib.directives").directive("barGraph",["$http",function(e){return{restrict:"AE",templateUrl:"ng-cier-lib/directives/bar-graph/bar-graph.html",replcae:!0,scope:{src:"@"},link:function(t){t.src&&(console.log(t.src),e.get(t.src).then(function(e){t.data=e.data})),t.options={chart:{type:"discreteBarChart",height:450,x:function(e){return e.label},y:function(e){return e.value+1e-10},showValues:!0}}}}}]),angular.module("ngCierLib.directives").directive("csvTable",["$http",function(e){function t(t){t.tableHeaders=[],t.tableData=[],e.get(t.src).then(function(e){var r=e.data.split("\n").map(function(e){return e.split(",")});t.tableHeaders=r[0],t.tableData=r.splice(1).map(function(e){var r={};return t.tableHeaders.forEach(function(t,i){r[t]=e[i]}),r})})}return{restrict:"E",replace:!0,templateUrl:"ng-cier-lib/directives/csvTable/csvTable.html",scope:{src:"@"},link:t}}]),angular.module("ngCierLib").run(["$templateCache",function(e){e.put("ng-cier-lib/directives/bar-graph/bar-graph.html",'<div class="bar-graph"><nvd3 options="options" data="data"></nvd3></div>'),e.put("ng-cier-lib/directives/csvTable/csvTable.html",'<div><table ts-wrapper><thead><tr><th ng-repeat="header in tableHeaders" ng-bind="header" ts-criteria="{{header}}"></th></tr></thead><tbody><tr ng-repeat="row in tableData" ts-repeat><td ng-repeat="header in tableHeaders">{{row[header]}}</td></tr></tbody></table></div>')}]);